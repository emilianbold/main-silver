<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="netbeans" name="javascript2.editor">
    <description>Builds, tests, and runs the project org.netbeans.modules.javascript2.editor</description>
    <import file="../nbbuild/templates/projectized.xml"/>

    <target name="release" depends="projectized.release">
        <!-- Generated JavaScript files for core libraries, used by code completion
             etc. See the generatestubs project for details. -->
        <unzip dest="${build.dir}" src="external/jsstubs.zip"/>
        <unzip dest="${build.dir}" src="external/js-domstubs.zip"/>
        <zip zipfile="${cluster}/jsstubs/allstubs.zip">
            <fileset dir="${build.dir}/jsstubs"/>
        </zip>
    </target>

    <!-- JFlex 1.4.3 handling (download and taskdef) -->
    <target name="-prepare-jflex" depends="build-init">
        <mkdir dir="${build.dir}/tools"/>
        <get src="http://repo1.maven.org/maven2/de/jflex/jflex/1.4.3/jflex-1.4.3.jar"
            dest="${build.dir}/tools/jflex.jar" verbose="true"/>
        <taskdef name="jflex"
            classname="JFlex.anttask.JFlexTask"
            classpath="${build.dir}/tools/jflex.jar" onerror="fail"/>
    </target>

    <!-- JavaScript section - generating JavaScript lexer -->
    <target name="-gen-js-lexer" depends="-prepare-jflex">
        <jflex file="tools/JavaScriptColoringScanner.flex" destdir="src" nobak="true"/>
    </target>
    <target name="-patch-js-lexer">
        <patch patchfile="tools/lexer-js.patch"
               dir="src/org/netbeans/modules/javascript2/editor/lexer"/>
    </target>
    <target name="gen-js-lexer" depends="-gen-js-lexer,-patch-js-lexer"/>

    <!-- JSON section - generating JSON lexer -->
    <target name="-gen-json-lexer" depends="-prepare-jflex">
        <jflex file="tools/JsonColoringScanner.flex" destdir="src" nobak="true"/>
    </target>
    <target name="-patch-json-lexer">
        <patch patchfile="tools/lexer-json.patch"
               dir="src/org/netbeans/modules/javascript2/editor/lexer"/>
    </target>
    <target name="gen-json-lexer" depends="-gen-json-lexer,-patch-json-lexer"/>

    <!-- JSDoc section - generating JSDoc lexer -->
    <target name="-gen-jsdoc-lexer" depends="-prepare-jflex">
        <jflex file="tools/JsDocColoringScanner.flex" destdir="src" nobak="true"/>
    </target>
    <target name="-patch-jsdoc-lexer">
        <patch patchfile="tools/lexer-jsdoc.patch"
               dir="src/org/netbeans/modules/javascript2/editor/jsdoc"/>
    </target>
    <target name="gen-jsdoc-lexer" depends="-gen-jsdoc-lexer,-patch-jsdoc-lexer"/>

    <!-- SDoc section - generating SDoc lexer -->
    <target name="-gen-sdoc-lexer" depends="-prepare-jflex">
        <jflex file="tools/SDocColoringScanner.flex" destdir="src" nobak="true"/>
    </target>
    <target name="-patch-sdoc-lexer">
        <patch patchfile="tools/lexer-sdoc.patch"
               dir="src/org/netbeans/modules/javascript2/editor/sdoc"/>
    </target>
    <target name="gen-sdoc-lexer" depends="-gen-sdoc-lexer,-patch-sdoc-lexer"/>

</project>

